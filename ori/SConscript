import sys

Import('env')

src = [
    "cmd_addkey.cc",
    "cmd_branch.cc",
    "cmd_branches.cc",
    "cmd_catobj.cc",
    "cmd_checkout.cc",
    "cmd_clone.cc",
    "cmd_commit.cc",
    "cmd_dumpobj.cc",
    "cmd_filelog.cc",
    "cmd_findheads.cc",
    "cmd_gc.cc",
    "cmd_graft.cc",
    "cmd_init.cc",
    "cmd_listkeys.cc",
    "cmd_listobj.cc",
    "cmd_log.cc",
    "cmd_merge.cc",
    "cmd_pull.cc",
    "cmd_purgecommit.cc",
    "cmd_purgeobj.cc",
    "cmd_rebuildindex.cc",
    "cmd_rebuildrefs.cc",
    "cmd_refcount.cc",
    "cmd_remote.cc",
    "cmd_removekey.cc",
    "cmd_setkey.cc",
    "cmd_show.cc",
    "cmd_snapshot.cc",
    "cmd_snapshots.cc",
    "cmd_stats.cc",
    "cmd_status.cc",
    "cmd_stripmetadata.cc",
    "cmd_tip.cc",
    "cmd_treediff.cc",
    "cmd_verify.cc",
    "fuse_cmd.cc",
    "main.cc",
    "server.cc",
]

if env["WITH_LIBS3"] == "1":
    src.append("cmd_backup.cc")

libs = [
        "crypto",
        "stdc++",
       ]

if sys.platform != "darwin":
    libs += ['rt']
    if env["WITH_MDNS"] == "1":
        libs += ['dns_sd']

if sys.platform == "linux2":
    libs += ['uuid', 'resolv']

env.Append( LIBS = libs )

env.Program("ori", src)

